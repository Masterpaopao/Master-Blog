## 工作笔记

>入职公司：XXXX
>
>入职岗位：Python数据分析工程师、量化工程师

---

### Week-1

#### 2022-03-28

- RPS指标选股策略

  - 定义:	

  ```
  RPS指标是由科学家欧奈尔提出的，并且可以进行市场分析。RPS指标也被人们称为股价相对强度指标，它通常是指在一定的时间内，某一只股票的涨幅状况在全部股票涨幅状况中排名的情况。在股票市场内有1000只股票，如果有一只股票的涨幅状况在1000只股票的排名状况为100名，则该只股票的rps指标值为90。
  ```

  - 接入项目思考：这是最基础的RPS指标选股策略，在一只股票大涨之前，他的强度排行一般是在87%左右，只有强度上来了，这只股票才能被称为热门股票。
  - 但是在中国A股的行情之下，很多策略失去了意义，如果仅仅是依靠rps指标去选股，很容易买到追涨的股票被主力下套在高位。
  - 所以，我将rps指标进行了一定的改正，将近5日每一日的涨跌幅的平均值，作为rps指标排行的基准。

- 代码过程记录

  - dataframe存进csv的时候某一列是字符串形式，但是取出来又不是了，能解决的办法就是`df["某一列"].astype(str)`然后再送进df.loc[]进行条件判断
  - 想要在dataframe数据中插入一条新的一行数据到某一行，只需要`df = pd.concat([df.iloc[:i - 1, :], df_add, df.iloc[i - 1:, :]])`，i是索引
  - df.loc[]获取出来的数据类型是<class 'numpy.xxx'>，如果你想要找到某一个元素去比较数据类型，使用loc[]的数据别忘记来一次类型转换；包括df.loc[]里面做条件判断运算的时候，里面的数据也需要强类型转换
  - 如果你需要更新dataframe某一列的数据，也许需要使用apply+匿名函数`rps_df["涨跌幅"] = rps_df.apply(lambda d: format_percent(d, "涨跌幅"), axis=1)`，axis=1是代表逐行操作

- 还需要进一步做的事

  - 整理东数西算概念板块的成分股
  - 修改股票列表的导入方式，改成本地文件形式导入（待定）
  - 将买1卖1合并进rps指标作为参考项
  - 加入量比进行辅助分析选股策略
  - vcp模型的研究

---

#### 2022-03-29

- 搞定了股票列表的导入方式，改成本地csv文件形式，以后加成分股更加方便了
- 删除了买1卖1的相关代码
- Python的线程操作已经开始吃不消了，出现了高概率的吞操作事件，于是我将rps指标全部移到redis操作，发现情况已经大大改善。这说明现在的项目已经开始撑不住更多密集的线程操作了，这是之后必须要解决的性能限制。
- 写代码发现自己越写越昏，居然在每条Tick的元操作周期内部，加入了实时的时间判断，难怪数据总是差一口气，因为每条Tick的元操作周期内部的时间是行情断续的，取决于收到数据的时间。所以要判断实时的时间，应该独立于此进程之外！
- 明天加成分股，走100只股的压力测试

---

#### 2022-03-30

- 东数西算概念成分股
  - 第一批
    - 英维克，佳力图，延华智能，美利云，贵广网络，数据港，亚康股份，依米康，首都在线，海兰信，海峡创新，英威腾，申菱环境，南都电源，科华数据，奥飞数据，海量数据，云赛智联，浙大网新
  - 第二批
    - 竞业达，天玑科技，南兴股份，美格智能，旗天科技，中国长城，紫光股份，浪潮信息，中科曙光，新易胜，中际旭创，光迅科技，东方国信，光环新网，润建股份，易华录，华扬联众，网宿科技，沙钢股份

---

#### 2022-03-31

- 项目问题记录
  - 尝试解耦微信发送程序到另一个项目，以分离的形态观测两边的错误情况
  - redis突然不推送数据  ->  已经针对性打logging监测
  - 微信程序剪切板中断  -> win32clipboard虽然快，但是不稳定

---

#### 2022-04-01

- 项目尝试优化方案
  - 微信程序剪切板经常中断
    - 发文字使用pyperclip模块
    - 发图片使用win32clipboard模块
  - 图片一分钟发送一次
    - 抛弃原来粗糙方法，改用redis设置时间锁
    - 发送一次之后，冷却程序1分钟，这样的控制更加稳定了一些
    - 注：如果有些股票一分钟没有交易数据，怎么办？

---

#### 2022-04-02

- 项目的优化思考
  - 应组长要求，补上差额代码
    - 立即着手完成
  - ~~将微信项目独立出去~~
    - ~~解耦性更好，也能分开观察各自的报错情况~~
  - 寻找win32clipboard偶发剪切板崩溃的问题
    - 暂无思路，继续探索
  - ~~MongDB数据库的好处虽然是自动生成不存在的集合，但是即使是每次都存在也要重复创建两只索引~~
    - ~~立即着手优化，加一层判断，集合存在就跳过~~
    - ~~已解决，废除实时TICK数据写入MongDB的需求~~
  - ~~在每一次写入行情信息的时候，每一只Tick都要重新算一遍前4个交易日的日期，能否优化？~~
    - ~~立即着手优化，将这一个重复的过程的运算结果加入到redis，减少实时运算压力~~
  - 抛弃原来的本地csv判断今天是否为交易日的写法，改用redis锁判断，减少Python读写文件的密度压力
    - 此条想法待定
  - ~~在每一次收集rps_data的时候，如果有些数据一分钟没有TICK信息，导致rps_data无法打包成功？~~
    - ~~判断打包到90%的进度就立马发送？可是这样会错过本应该能收到的数据~~
    - ~~能不能再弄一个redis锁？锁到时间了立马打包发送，这样也留了足够的缓冲时间~~
  - 等待2022-04-06拿到Query权限，获取每一只股票的近三年最高价和最低价补充到回放数据库里面
    - 暂时不考虑加入Tick数据库实时更新，会徒增消耗压力，就放在Playback回放数据库做个滞后比较
    - 如果数据有变动，每天闭市之后，再更新csv文件里面的最高价和最低价，并写入到当天的回放数据库信息，这样一来，新的一天只需要读取昨日的最高价和最低价，更加突出突破的特征，闭市之后再更新进去csv文件和数据库，减少开市时的程序资源消耗
  - ~~将Tick数据写入MongDB的必要性~~
    - ~~目前压根没用上MongDB的Tick数据库，而且我们有华泰终端这个强大的工具，想要复盘直接去下载csv~~
    - ~~下期版本砍掉将TICK写入MongDB数据库的代码，只保留写入Playback回放数据~~
    - ~~尽可能优化项目到极致，能不计算的就不计算，直接把结果放在MongDB或Redis~~
    - ~~这样才能支撑更多的实时计算力，去一步步壮大项目~~

---

### Week-2

#### 2022-04-06

- redis时间锁的代码顺序要很严格才不会出错、
- 对剪切板容易报错的模块，进行一个异常健壮处理
- 已拿到最高价最低价的获取SDK

---

#### 2022-04-07

- ~~完善220只股票的所有历史数据~~
- ~~接入220只股票近一年的最高价最低价，进行初步分析~~
- 分析redis时间锁和excel2img模块的稳定性
- 将后半部分进行一个省略号处理，将数据缩略到前40名和倒数10名
- 运行到还是出现了无限rps_data锁的问题

---

2022-04-08

- 将项目部署在虚拟机，验证程序稳定性
- 年最高和年最低的数据分析初步完成

---

### Week-3

#### 2022-04-11

- rps_data锁取得突破性进展，将两个redis操作强行合并到一个原子操作，避免并发错误
- 参考文档：https://cloud.tencent.com/developer/article/1554080

---

#### 2022-04-12

- 将项目升级为双群操作，继续部署在虚拟机验证程序稳定性
- 修改最高价与最低价的颜色渲染，风格更为突出

---

#### 2022-04-13

- 更新5日均线战法分析
- 取消playback接口，改用query接口补充历史数据，明天完成测试
- 待做
  - 过滤数据
  - 5日均线战法染色
  - 写进操盘原则到图片
- 注意mouse_click的报错原因

---

#### 2022-04-20

- 5日均线战法已经初现雏形
- 但仍然还需要一定的细节打磨，现在的条件设置太过于死板，也很容易错过3日就启动的妖股
